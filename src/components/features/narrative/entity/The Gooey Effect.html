<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gooey Circle with Border</title>
    <style>
      body {
        margin: 0;
        background: white;
        overflow: hidden;
        font-family: sans-serif;
        color: black;
      }

      .gooey-wrapper {
        position: relative;
        width: 100vw;
        height: 100vh;
        filter: url(#gooey-border);
      }

      .circle {
        position: absolute;
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: #3b82f6;
        animation: float 6s ease-in-out infinite;
      }

      .circle:nth-child(2) {
        left: 150px;
        top: 100px;
        background: #3b82f6;
        animation-delay: 1s;
      }

      .circle:nth-child(3) {
        left: 300px;
        top: 200px;
        background: #3b82f6;
        animation-delay: 2s;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-60px);
        }
      }

      .controls {
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 10;
        background: rgba(0, 0, 0, 0.05);
        padding: 10px;
        border-radius: 8px;
      }

      .control-group {
        margin-bottom: 10px;
      }

      input[type="range"] {
        width: 200px;
      }
    </style>
  </head>
  <body>
    <div class="controls">
      <div class="control-group">
        <label for="gooeyStrength">粘性 (Strength): </label>
        <input type="range" id="gooeyStrength" min="5" max="30" value="18" />
        <span id="strengthValue">18</span>
      </div>
      <div class="control-group">
        <label for="nodeSize">节点大小: </label>
        <input type="range" id="nodeSize" min="20" max="200" value="100" />
        <span id="sizeValue">100</span>
      </div>
      <div class="control-group">
        <label for="borderThickness">边框粗细: </label>
        <input type="range" id="borderThickness" min="1" max="20" value="2" />
        <span id="borderValue">2</span>
      </div>
    </div>

    <svg width="0" height="0">
      <filter id="gooey-border">
        <feGaussianBlur
          id="blurNode"
          in="SourceGraphic"
          stdDeviation="10"
          result="blur"
        />
        <feColorMatrix
          id="matrixNode"
          in="blur"
          mode="matrix"
          values="1 0 0 0 0  
                0 1 0 0 0  
                0 0 1 0 0  
                0 0 0 18 -8"
          result="goo"
        />
        <feMorphology
          id="morphologyNode"
          in="goo"
          operator="dilate"
          radius="2"
          result="dilated"
        />
        <feComposite in="dilated" in2="goo" operator="xor" result="border" />
        <feFlood flood-color="black" result="blackColor" />
        <feComposite
          in="blackColor"
          in2="border"
          operator="in"
          result="blackBorder"
        />
        <feMerge>
          <feMergeNode in="blackBorder" />
          <feMergeNode in="goo" />
        </feMerge>
      </filter>
    </svg>

    <div class="gooey-wrapper">
      <div class="circle" style="left: 50px; top: 50px"></div>
      <div class="circle"></div>
      <div class="circle"></div>
    </div>

    <script>
      const strengthSlider = document.getElementById("gooeyStrength");
      const strengthValue = document.getElementById("strengthValue");
      const matrixNode = document.getElementById("matrixNode");

      const sizeSlider = document.getElementById("nodeSize");
      const sizeValue = document.getElementById("sizeValue");
      const circles = document.querySelectorAll(".circle");

      const borderSlider = document.getElementById("borderThickness");
      const borderValue = document.getElementById("borderValue");
      const morphologyNode = document.getElementById("morphologyNode");

      function updateGooeyParameters() {
        const strength = +strengthSlider.value;
        const size = +sizeSlider.value;
        const border = +borderSlider.value;

        strengthValue.textContent = strength;
        sizeValue.textContent = size;
        borderValue.textContent = border;

        // 计算 blur 基于大小和边框粗细
        const blur = Math.max(4, size * 0.1 + border * 0.5);
        document
          .getElementById("blurNode")
          .setAttribute("stdDeviation", blur.toFixed(1));

        const matrix = `1 0 0 0 0  
                      0 1 0 0 0  
                      0 0 1 0 0  
                      0 0 0 ${strength} -8`;
        matrixNode.setAttribute("values", matrix);

        morphologyNode.setAttribute("radius", border);

        circles.forEach((circle) => {
          circle.style.width = size + "px";
          circle.style.height = size + "px";
        });
      }

      strengthSlider.addEventListener("input", updateGooeyParameters);
      sizeSlider.addEventListener("input", updateGooeyParameters);
      borderSlider.addEventListener("input", updateGooeyParameters);

      window.addEventListener("DOMContentLoaded", updateGooeyParameters);
    </script>
  </body>
</html>
